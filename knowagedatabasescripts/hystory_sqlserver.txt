Insert in this file the history of DB Schema, only for SQL Server
Every items must have:
- The Developer who has made the change
- The SQL script that updates the schema ( schema, index and FK )
- The Date

-- ##################################################################################################

-- 23.02.2015 Francesco Lucchi: removed SBI_DOSSIER_* tables.

-- 06.05.2016 Alessandro Portosa: Renamed HIBERNATE_SEQUENCES and its fields with lowercase. It must be lowercase for Unix compatibility

--09.05.2016 Giulio Gavardi
ALTER T

--10.06.2016 Antonella Giachino: add hierarchy_name, level and member_name in SBI_GEO_MAP
ALTER TABLE  SBI_GEO_MAPS ADD HIERARCHY_NAME VARCHAR(100);
ALTER TABLE  SBI_GEO_MAPS ADD LEVEL INTEGER;
ALTER TABLE  SBI_GEO_MAPS ADD MEMBER_NAME VARCHAR(100);

-- 15.6.2016 Antonella: deleted WORSKSHEET engine - clean db from its user func and engines
ALTER TABLE SBI_USER_FUNC NOCHECK CONSTRAINT ALL;
DELETE from SBI_USER_FUNC  where name = 'CreateWorksheetFromDatasetUserFunctionality';
ALTER TABLE SBI_USER_FUNC WITH CHECK CHECK CONSTRAINT ALL;

ALTER TABLE SBI_OBJECTS NOCHECK CONSTRAINT ALL;
DELETE FROM SBI_OBJECTS WHERE ENGINE_ID = (select engine_id from SBI_ENGINES  where name = 'Worksheet Engine');
ALTER TABLE SBI_OBJECTS WITH CHECK CHECK CONSTRAINT ALL;

ALTER TABLE SBI_ENGINES NOCHECK CONSTRAINT ALL;
DELETE from SBI_ENGINES  where name = 'Worksheet Engine';
ALTER TABLE SBI_ENGINES WITH CHECK CHECK CONSTRAINT ALL;

ALTER TABLE SBI_DOMAINS NOCHECK CONSTRAINT ALL;
DELETE from SBI_DOMAINS where value_cd = 'WORKSHEET';
ALTER TABLE SBI_DOMAINS WITH CHECK CHECK CONSTRAINT ALL;

sp_RENAME 'SBI_GEO_MAPS.LEVEL', 'NUM_LEVEL' , 'COLUMN';


CREATE TABLE SBI_WHATIF_WORKFLOW(
	ID INT,
    MODEL_ID INT,
    USER_ID INT,
    SEQUENCE INT,
    STATE VARCHAR(20),
    NOTES VARCHAR(100),
    INFO VARCHAR(100),
	USER_IN VARCHAR(100) NOT NULL,
	USER_UP VARCHAR(100) NULL,
	USER_DE VARCHAR(100) NULL,
	TIME_IN DATETIME NULL DEFAULT NULL,
	TIME_UP DATETIME NULL,
	TIME_DE DATETIME NULL,
	SBI_VERSION_IN VARCHAR(10) NULL,
	SBI_VERSION_UP VARCHAR(10) NULL,
	SBI_VERSION_DE VARCHAR(10) NULL,
	ORGANIZATION VARCHAR(20) NULL,
    PRIMARY KEY (ID)
);
ALTER TABLE SBI_WHATIF_WORKFLOW 				ADD CONSTRAINT FK_SBI_MODEL_WORKFLOW			FOREIGN KEY (MODEL_ID) 			REFERENCES SBI_ARTIFACTS(ID)	ON DELETE CASCADE ON UPDATE NO ACTION;
ALTER TABLE SBI_WHATIF_WORKFLOW 				ADD CONSTRAINT FK_SBI_USER_WORKFLOW			FOREIGN KEY (USER_ID) 				REFERENCES SBI_USER(ID) ON DELETE CASCADE ON UPDATE NO ACTION;

-- 09.08.2016 Alberto Ghedin: refactoring whatif start actions
update SBI_ENGINES set MAIN_URL="/knowagewhatifengine/restful-services/olap/startolap" where label = "knowageolapengine";
update SBI_ENGINES set MAIN_URL="/knowagewhatifengine/restful-services/olap/startwhatif" where label = "knowagewhatifengine";